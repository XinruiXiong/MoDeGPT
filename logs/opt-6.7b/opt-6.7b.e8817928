2025-05-09 22:52:16,649 - INFO - Loading model: facebook/opt-6.7b
2025-05-09 22:52:16,649 - INFO - Loading model from: facebook/opt-6.7b
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:03<00:03,  3.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:04<00:00,  1.93s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:04<00:00,  2.16s/it]
2025-05-09 22:54:23,051 - INFO - ✔ Loaded model on cuda:1 with float16.
2025-05-09 22:54:23,053 - INFO - Loading calibration and evaluation texts...
2025-05-09 22:54:34,846 - INFO - Evaluating original model (for baseline perplexity)...
2025-05-09 22:55:08,270 - INFO - Original model perplexity on WikiText2: 10.29
2025-05-09 22:55:08,335 - INFO - Calibrating model...
2025-05-09 22:55:08,336 - INFO - Detected architecture: opt
2025-05-09 23:00:54,296 - INFO - Finished calibration and computed BI scores.
2025-05-09 23:00:54,304 - INFO - Allocating layer sparsity...
2025-05-09 23:00:54,304 - INFO - Allocating global sparsity using target keep ratio 0.5000 and temperature 1.0
2025-05-09 23:00:54,304 - INFO - Layer  0: keep_ratio = 1.0000 (BI = 0.9506)
2025-05-09 23:00:54,304 - INFO - Layer  1: keep_ratio = 0.4839 (BI = 0.0167)
2025-05-09 23:00:54,304 - INFO - Layer  2: keep_ratio = 0.4908 (BI = 0.0027)
2025-05-09 23:00:54,304 - INFO - Layer  3: keep_ratio = 0.4913 (BI = 0.0017)
2025-05-09 23:00:54,304 - INFO - Layer  4: keep_ratio = 0.4913 (BI = 0.0016)
2025-05-09 23:00:54,304 - INFO - Layer  5: keep_ratio = 0.4912 (BI = 0.0019)
2025-05-09 23:00:54,304 - INFO - Layer  6: keep_ratio = 0.4909 (BI = 0.0024)
2025-05-09 23:00:54,304 - INFO - Layer  7: keep_ratio = 0.4907 (BI = 0.0028)
2025-05-09 23:00:54,304 - INFO - Layer  8: keep_ratio = 0.4903 (BI = 0.0037)
2025-05-09 23:00:54,304 - INFO - Layer  9: keep_ratio = 0.4896 (BI = 0.0050)
2025-05-09 23:00:54,304 - INFO - Layer 10: keep_ratio = 0.4893 (BI = 0.0057)
2025-05-09 23:00:54,304 - INFO - Layer 11: keep_ratio = 0.4885 (BI = 0.0073)
2025-05-09 23:00:54,304 - INFO - Layer 12: keep_ratio = 0.4879 (BI = 0.0086)
2025-05-09 23:00:54,304 - INFO - Layer 13: keep_ratio = 0.4871 (BI = 0.0103)
2025-05-09 23:00:54,304 - INFO - Layer 14: keep_ratio = 0.4862 (BI = 0.0121)
2025-05-09 23:00:54,304 - INFO - Layer 15: keep_ratio = 0.4847 (BI = 0.0152)
2025-05-09 23:00:54,304 - INFO - Layer 16: keep_ratio = 0.4833 (BI = 0.0180)
2025-05-09 23:00:54,304 - INFO - Layer 17: keep_ratio = 0.4822 (BI = 0.0204)
2025-05-09 23:00:54,305 - INFO - Layer 18: keep_ratio = 0.4811 (BI = 0.0227)
2025-05-09 23:00:54,305 - INFO - Layer 19: keep_ratio = 0.4798 (BI = 0.0253)
2025-05-09 23:00:54,305 - INFO - Layer 20: keep_ratio = 0.4792 (BI = 0.0266)
2025-05-09 23:00:54,305 - INFO - Layer 21: keep_ratio = 0.4773 (BI = 0.0304)
2025-05-09 23:00:54,305 - INFO - Layer 22: keep_ratio = 0.4786 (BI = 0.0279)
2025-05-09 23:00:54,305 - INFO - Layer 23: keep_ratio = 0.4762 (BI = 0.0329)
2025-05-09 23:00:54,305 - INFO - Layer 24: keep_ratio = 0.4770 (BI = 0.0312)
2025-05-09 23:00:54,305 - INFO - Layer 25: keep_ratio = 0.4768 (BI = 0.0315)
2025-05-09 23:00:54,305 - INFO - Layer 26: keep_ratio = 0.4766 (BI = 0.0319)
2025-05-09 23:00:54,305 - INFO - Layer 27: keep_ratio = 0.4782 (BI = 0.0287)
2025-05-09 23:00:54,305 - INFO - Layer 28: keep_ratio = 0.4800 (BI = 0.0250)
2025-05-09 23:00:54,305 - INFO - Layer 29: keep_ratio = 0.4808 (BI = 0.0233)
2025-05-09 23:00:54,305 - INFO - Layer 30: keep_ratio = 0.4800 (BI = 0.0248)
2025-05-09 23:00:54,305 - INFO - Layer 31: keep_ratio = 0.4794 (BI = 0.0261)
2025-05-09 23:00:54,305 - INFO - Freeing original model from GPU before compression...
2025-05-09 23:00:59,074 - INFO - n_layers=32, n_heads=32, d_model=4096, head_dim=128
2025-05-09 23:00:59,075 - INFO - Applying MoDeGPT compression methods...
2025-05-09 23:04:32,506 - INFO - [MLP] Compressed layer 0 to rank 16384 (Nyström, λ=0.01)
2025-05-09 23:05:23,131 - INFO - [MLP] Compressed layer 1 to rank 7928 (Nyström, λ=0.01)
2025-05-09 23:06:15,892 - INFO - [MLP] Compressed layer 2 to rank 8040 (Nyström, λ=0.01)
2025-05-09 23:07:04,120 - INFO - [MLP] Compressed layer 3 to rank 8048 (Nyström, λ=0.01)
2025-05-09 23:07:58,010 - INFO - [MLP] Compressed layer 4 to rank 8049 (Nyström, λ=0.01)
2025-05-09 23:08:52,158 - INFO - [MLP] Compressed layer 5 to rank 8047 (Nyström, λ=0.01)
2025-05-09 23:09:48,950 - INFO - [MLP] Compressed layer 6 to rank 8043 (Nyström, λ=0.01)
2025-05-09 23:10:44,912 - INFO - [MLP] Compressed layer 7 to rank 8040 (Nyström, λ=0.01)
2025-05-09 23:11:35,319 - INFO - [MLP] Compressed layer 8 to rank 8032 (Nyström, λ=0.01)
2025-05-09 23:12:33,414 - INFO - [MLP] Compressed layer 9 to rank 8022 (Nyström, λ=0.01)
2025-05-09 23:13:26,894 - INFO - [MLP] Compressed layer 10 to rank 8016 (Nyström, λ=0.01)
2025-05-09 23:14:24,539 - INFO - [MLP] Compressed layer 11 to rank 8004 (Nyström, λ=0.01)
2025-05-09 23:15:21,498 - INFO - [MLP] Compressed layer 12 to rank 7993 (Nyström, λ=0.01)
2025-05-09 23:16:15,583 - INFO - [MLP] Compressed layer 13 to rank 7980 (Nyström, λ=0.01)
2025-05-09 23:17:10,188 - INFO - [MLP] Compressed layer 14 to rank 7965 (Nyström, λ=0.01)
2025-05-09 23:18:03,731 - INFO - [MLP] Compressed layer 15 to rank 7941 (Nyström, λ=0.01)
2025-05-09 23:18:57,183 - INFO - [MLP] Compressed layer 16 to rank 7918 (Nyström, λ=0.01)
2025-05-09 23:19:50,640 - INFO - [MLP] Compressed layer 17 to rank 7899 (Nyström, λ=0.01)
2025-05-09 23:20:45,086 - INFO - [MLP] Compressed layer 18 to rank 7881 (Nyström, λ=0.01)
2025-05-09 23:21:38,235 - INFO - [MLP] Compressed layer 19 to rank 7860 (Nyström, λ=0.01)
2025-05-09 23:22:31,502 - INFO - [MLP] Compressed layer 20 to rank 7850 (Nyström, λ=0.01)
2025-05-09 23:23:23,189 - INFO - [MLP] Compressed layer 21 to rank 7820 (Nyström, λ=0.01)
2025-05-09 23:24:18,768 - INFO - [MLP] Compressed layer 22 to rank 7841 (Nyström, λ=0.01)
2025-05-09 23:25:11,760 - INFO - [MLP] Compressed layer 23 to rank 7801 (Nyström, λ=0.01)
2025-05-09 23:26:05,455 - INFO - [MLP] Compressed layer 24 to rank 7814 (Nyström, λ=0.01)
2025-05-09 23:26:56,721 - INFO - [MLP] Compressed layer 25 to rank 7812 (Nyström, λ=0.01)
2025-05-09 23:27:49,633 - INFO - [MLP] Compressed layer 26 to rank 7809 (Nyström, λ=0.01)
2025-05-09 23:28:43,723 - INFO - [MLP] Compressed layer 27 to rank 7834 (Nyström, λ=0.01)
2025-05-09 23:29:36,512 - INFO - [MLP] Compressed layer 28 to rank 7863 (Nyström, λ=0.01)
2025-05-09 23:30:30,093 - INFO - [MLP] Compressed layer 29 to rank 7876 (Nyström, λ=0.01)
2025-05-09 23:31:22,940 - INFO - [MLP] Compressed layer 30 to rank 7864 (Nyström, λ=0.01)
2025-05-09 23:32:17,616 - INFO - [MLP] Compressed layer 31 to rank 7854 (Nyström, λ=0.01)
2025-05-09 23:32:27,480 - INFO - [QK] Compressed layer 0 to rank 128 per head (ridge λ=0.01)
2025-05-09 23:32:37,029 - INFO - [QK] Compressed layer 1 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:32:46,590 - INFO - [QK] Compressed layer 2 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:32:56,143 - INFO - [QK] Compressed layer 3 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:33:05,693 - INFO - [QK] Compressed layer 4 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:33:15,249 - INFO - [QK] Compressed layer 5 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:33:24,785 - INFO - [QK] Compressed layer 6 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:33:34,335 - INFO - [QK] Compressed layer 7 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:33:43,904 - INFO - [QK] Compressed layer 8 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:33:53,433 - INFO - [QK] Compressed layer 9 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:34:03,104 - INFO - [QK] Compressed layer 10 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:34:12,530 - INFO - [QK] Compressed layer 11 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:34:22,069 - INFO - [QK] Compressed layer 12 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:34:31,624 - INFO - [QK] Compressed layer 13 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:34:41,165 - INFO - [QK] Compressed layer 14 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:34:50,830 - INFO - [QK] Compressed layer 15 to rank 62 per head (ridge λ=0.01)
2025-05-09 23:35:00,273 - INFO - [QK] Compressed layer 16 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:35:09,825 - INFO - [QK] Compressed layer 17 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:35:19,379 - INFO - [QK] Compressed layer 18 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:35:28,952 - INFO - [QK] Compressed layer 19 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:35:38,487 - INFO - [QK] Compressed layer 20 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:35:48,050 - INFO - [QK] Compressed layer 21 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:35:57,604 - INFO - [QK] Compressed layer 22 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:36:07,155 - INFO - [QK] Compressed layer 23 to rank 60 per head (ridge λ=0.01)
2025-05-09 23:36:16,727 - INFO - [QK] Compressed layer 24 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:36:26,288 - INFO - [QK] Compressed layer 25 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:36:35,851 - INFO - [QK] Compressed layer 26 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:36:45,403 - INFO - [QK] Compressed layer 27 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:36:54,963 - INFO - [QK] Compressed layer 28 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:37:04,518 - INFO - [QK] Compressed layer 29 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:37:14,073 - INFO - [QK] Compressed layer 30 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:37:23,625 - INFO - [QK] Compressed layer 31 to rank 61 per head (ridge λ=0.01)
2025-05-09 23:37:23,627 - WARNING - [VO] Layer 0: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,627 - WARNING - [VO] Layer 1: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,627 - WARNING - [VO] Layer 2: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,627 - WARNING - [VO] Layer 3: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,627 - WARNING - [VO] Layer 4: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,627 - WARNING - [VO] Layer 5: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,627 - WARNING - [VO] Layer 6: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,627 - WARNING - [VO] Layer 7: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,627 - WARNING - [VO] Layer 8: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,627 - WARNING - [VO] Layer 9: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,627 - WARNING - [VO] Layer 10: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,627 - WARNING - [VO] Layer 11: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 12: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 13: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 14: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 15: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 16: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 17: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 18: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 19: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 20: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 21: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 22: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 23: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 24: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 25: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 26: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 27: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 28: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 29: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 30: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - WARNING - [VO] Layer 31: cannot access v_proj/o_proj: 'OPTModel' object has no attribute 'layers'
2025-05-09 23:37:23,628 - INFO - Saving compressed model...
2025-05-09 23:39:30,549 - INFO - ✔ Model, tokenizer, and tokenizer_source.txt saved to /u/scratch/x/xxiong/compressed_output/opt-6.7b
2025-05-09 23:39:30,554 - INFO - Reloading compressed model for evaluation...
2025-05-09 23:39:30,554 - INFO - Reloading compressed model from: /u/scratch/x/xxiong/compressed_output/opt-6.7b
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:03,  1.87s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:03<00:01,  1.90s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.11s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.32s/it]
2025-05-09 23:41:11,855 - INFO - ✔ Reloaded compressed model to cuda:1 successfully.
2025-05-09 23:41:44,189 - INFO - Compressed model perplexity on WikiText2: 17.13
