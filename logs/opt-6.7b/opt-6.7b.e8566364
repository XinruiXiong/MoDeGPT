2025-05-01 18:14:15,768 - INFO - Loading model: facebook/opt-6.7b
2025-05-01 18:14:15,768 - INFO - Loading model from: facebook/opt-6.7b
2025-05-01 18:14:25,541 - WARNING - [Fallback] device_map='auto' failed: Device cuda:0 is not recognized, available devices are integers(for GPU/XPU), 'mps', 'cpu' and 'disk'
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.91it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  7.68it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  7.34it/s]
2025-05-01 18:14:32,009 - INFO - ✔ Loaded with model.to(device) fallback.
2025-05-01 18:14:32,012 - INFO - Loading calibration and evaluation texts...
2025-05-01 18:14:43,542 - INFO - Evaluating original model (for baseline perplexity)...
2025-05-01 18:14:49,488 - INFO - Original model perplexity on WikiText2: 8.47
2025-05-01 18:14:49,488 - INFO - Calibrating model...
2025-05-01 18:14:49,488 - INFO - Detected architecture: opt
2025-05-01 18:15:55,657 - INFO - Finished calibration and computed BI scores.
2025-05-01 18:15:55,661 - INFO - Allocating layer sparsity...
2025-05-01 18:15:55,661 - INFO - Allocating global sparsity using target keep ratio 0.5000 and temperature 1.0
2025-05-01 18:15:55,661 - INFO - Layer  0: keep_ratio = 0.1935 (BI = 0.9759)
2025-05-01 18:15:55,661 - INFO - Layer  1: keep_ratio = 0.5079 (BI = 0.0107)
2025-05-01 18:15:55,661 - INFO - Layer  2: keep_ratio = 0.5130 (BI = 0.0007)
2025-05-01 18:15:55,661 - INFO - Layer  3: keep_ratio = 0.5132 (BI = 0.0003)
2025-05-01 18:15:55,661 - INFO - Layer  4: keep_ratio = 0.5132 (BI = 0.0003)
2025-05-01 18:15:55,661 - INFO - Layer  5: keep_ratio = 0.5132 (BI = 0.0003)
2025-05-01 18:15:55,661 - INFO - Layer  6: keep_ratio = 0.5132 (BI = 0.0003)
2025-05-01 18:15:55,661 - INFO - Layer  7: keep_ratio = 0.5132 (BI = 0.0004)
2025-05-01 18:15:55,661 - INFO - Layer  8: keep_ratio = 0.5131 (BI = 0.0005)
2025-05-01 18:15:55,661 - INFO - Layer  9: keep_ratio = 0.5131 (BI = 0.0006)
2025-05-01 18:15:55,661 - INFO - Layer 10: keep_ratio = 0.5131 (BI = 0.0006)
2025-05-01 18:15:55,661 - INFO - Layer 11: keep_ratio = 0.5130 (BI = 0.0007)
2025-05-01 18:15:55,661 - INFO - Layer 12: keep_ratio = 0.5130 (BI = 0.0008)
2025-05-01 18:15:55,661 - INFO - Layer 13: keep_ratio = 0.5130 (BI = 0.0007)
2025-05-01 18:15:55,661 - INFO - Layer 14: keep_ratio = 0.5129 (BI = 0.0010)
2025-05-01 18:15:55,661 - INFO - Layer 15: keep_ratio = 0.5127 (BI = 0.0013)
2025-05-01 18:15:55,661 - INFO - Layer 16: keep_ratio = 0.5124 (BI = 0.0019)
2025-05-01 18:15:55,661 - INFO - Layer 17: keep_ratio = 0.5122 (BI = 0.0024)
2025-05-01 18:15:55,661 - INFO - Layer 18: keep_ratio = 0.5118 (BI = 0.0031)
2025-05-01 18:15:55,661 - INFO - Layer 19: keep_ratio = 0.5112 (BI = 0.0043)
2025-05-01 18:15:55,661 - INFO - Layer 20: keep_ratio = 0.5108 (BI = 0.0051)
2025-05-01 18:15:55,661 - INFO - Layer 21: keep_ratio = 0.5096 (BI = 0.0073)
2025-05-01 18:15:55,661 - INFO - Layer 22: keep_ratio = 0.5092 (BI = 0.0083)
2025-05-01 18:15:55,661 - INFO - Layer 23: keep_ratio = 0.5068 (BI = 0.0129)
2025-05-01 18:15:55,661 - INFO - Layer 24: keep_ratio = 0.5053 (BI = 0.0159)
2025-05-01 18:15:55,661 - INFO - Layer 25: keep_ratio = 0.5027 (BI = 0.0210)
2025-05-01 18:15:55,661 - INFO - Layer 26: keep_ratio = 0.5016 (BI = 0.0233)
2025-05-01 18:15:55,661 - INFO - Layer 27: keep_ratio = 0.5051 (BI = 0.0162)
2025-05-01 18:15:55,661 - INFO - Layer 28: keep_ratio = 0.5056 (BI = 0.0152)
2025-05-01 18:15:55,661 - INFO - Layer 29: keep_ratio = 0.5059 (BI = 0.0148)
2025-05-01 18:15:55,661 - INFO - Layer 30: keep_ratio = 0.5049 (BI = 0.0166)
2025-05-01 18:15:55,661 - INFO - Layer 31: keep_ratio = 0.5004 (BI = 0.0255)
2025-05-01 18:15:55,661 - INFO - Freeing original model from GPU before compression...
2025-05-01 18:15:59,627 - INFO - n_layers=32, n_heads=32, d_model=4096, head_dim=128
2025-05-01 18:15:59,628 - INFO - Applying MoDeGPT compression methods...
2025-05-01 18:17:13,103 - INFO - [MLP] Compressed layer 0 to rank 3169 (Nyström, λ=0.01)
2025-05-01 18:19:09,274 - INFO - [MLP] Compressed layer 1 to rank 8322 (Nyström, λ=0.01)
2025-05-01 18:20:57,861 - INFO - [MLP] Compressed layer 2 to rank 8405 (Nyström, λ=0.01)
2025-05-01 18:22:50,799 - INFO - [MLP] Compressed layer 3 to rank 8409 (Nyström, λ=0.01)
2025-05-01 18:24:48,093 - INFO - [MLP] Compressed layer 4 to rank 8408 (Nyström, λ=0.01)
2025-05-01 18:26:33,075 - INFO - [MLP] Compressed layer 5 to rank 8408 (Nyström, λ=0.01)
2025-05-01 18:28:18,229 - INFO - [MLP] Compressed layer 6 to rank 8408 (Nyström, λ=0.01)
2025-05-01 18:30:14,189 - INFO - [MLP] Compressed layer 7 to rank 8407 (Nyström, λ=0.01)
2025-05-01 18:32:03,615 - INFO - [MLP] Compressed layer 8 to rank 8407 (Nyström, λ=0.01)
2025-05-01 18:33:41,334 - INFO - [MLP] Compressed layer 9 to rank 8406 (Nyström, λ=0.01)
2025-05-01 18:35:35,702 - INFO - [MLP] Compressed layer 10 to rank 8405 (Nyström, λ=0.01)
2025-05-01 18:37:28,748 - INFO - [MLP] Compressed layer 11 to rank 8405 (Nyström, λ=0.01)
2025-05-01 18:39:23,453 - INFO - [MLP] Compressed layer 12 to rank 8404 (Nyström, λ=0.01)
2025-05-01 18:41:16,927 - INFO - [MLP] Compressed layer 13 to rank 8405 (Nyström, λ=0.01)
2025-05-01 18:43:03,124 - INFO - [MLP] Compressed layer 14 to rank 8402 (Nyström, λ=0.01)
2025-05-01 18:44:51,252 - INFO - [MLP] Compressed layer 15 to rank 8400 (Nyström, λ=0.01)
2025-05-01 18:46:31,689 - INFO - [MLP] Compressed layer 16 to rank 8395 (Nyström, λ=0.01)
2025-05-01 18:48:20,518 - INFO - [MLP] Compressed layer 17 to rank 8391 (Nyström, λ=0.01)
2025-05-01 18:50:06,254 - INFO - [MLP] Compressed layer 18 to rank 8384 (Nyström, λ=0.01)
2025-05-01 18:51:59,193 - INFO - [MLP] Compressed layer 19 to rank 8375 (Nyström, λ=0.01)
2025-05-01 18:53:38,282 - INFO - [MLP] Compressed layer 20 to rank 8368 (Nyström, λ=0.01)
2025-05-01 18:55:37,164 - INFO - [MLP] Compressed layer 21 to rank 8350 (Nyström, λ=0.01)
2025-05-01 18:57:28,800 - INFO - [MLP] Compressed layer 22 to rank 8342 (Nyström, λ=0.01)
2025-05-01 18:59:22,391 - INFO - [MLP] Compressed layer 23 to rank 8303 (Nyström, λ=0.01)
2025-05-01 19:01:17,930 - INFO - [MLP] Compressed layer 24 to rank 8278 (Nyström, λ=0.01)
2025-05-01 19:03:13,243 - INFO - [MLP] Compressed layer 25 to rank 8236 (Nyström, λ=0.01)
2025-05-01 19:05:01,545 - INFO - [MLP] Compressed layer 26 to rank 8217 (Nyström, λ=0.01)
2025-05-01 19:07:01,971 - INFO - [MLP] Compressed layer 27 to rank 8275 (Nyström, λ=0.01)
2025-05-01 19:08:57,603 - INFO - [MLP] Compressed layer 28 to rank 8284 (Nyström, λ=0.01)
2025-05-01 19:10:54,952 - INFO - [MLP] Compressed layer 29 to rank 8287 (Nyström, λ=0.01)
2025-05-01 19:12:47,751 - INFO - [MLP] Compressed layer 30 to rank 8273 (Nyström, λ=0.01)
2025-05-01 19:14:32,546 - INFO - [MLP] Compressed layer 31 to rank 8199 (Nyström, λ=0.01)
2025-05-01 19:14:53,565 - INFO - [QK] Compressed layer 0 to rank 24 per head (ridge λ=0.01)
2025-05-01 19:15:16,942 - INFO - [QK] Compressed layer 1 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:15:38,678 - INFO - [QK] Compressed layer 2 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:16:02,184 - INFO - [QK] Compressed layer 3 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:16:23,925 - INFO - [QK] Compressed layer 4 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:16:46,587 - INFO - [QK] Compressed layer 5 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:17:10,012 - INFO - [QK] Compressed layer 6 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:17:31,387 - INFO - [QK] Compressed layer 7 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:17:54,289 - INFO - [QK] Compressed layer 8 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:18:17,782 - INFO - [QK] Compressed layer 9 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:18:39,780 - INFO - [QK] Compressed layer 10 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:19:02,836 - INFO - [QK] Compressed layer 11 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:19:26,255 - INFO - [QK] Compressed layer 12 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:19:47,560 - INFO - [QK] Compressed layer 13 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:20:10,956 - INFO - [QK] Compressed layer 14 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:20:34,357 - INFO - [QK] Compressed layer 15 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:20:54,746 - INFO - [QK] Compressed layer 16 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:21:18,175 - INFO - [QK] Compressed layer 17 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:21:39,419 - INFO - [QK] Compressed layer 18 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:21:59,593 - INFO - [QK] Compressed layer 19 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:22:20,519 - INFO - [QK] Compressed layer 20 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:22:40,890 - INFO - [QK] Compressed layer 21 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:23:01,697 - INFO - [QK] Compressed layer 22 to rank 65 per head (ridge λ=0.01)
2025-05-01 19:23:24,998 - INFO - [QK] Compressed layer 23 to rank 64 per head (ridge λ=0.01)
2025-05-01 19:23:48,327 - INFO - [QK] Compressed layer 24 to rank 64 per head (ridge λ=0.01)
2025-05-01 19:24:09,582 - INFO - [QK] Compressed layer 25 to rank 64 per head (ridge λ=0.01)
2025-05-01 19:24:32,925 - INFO - [QK] Compressed layer 26 to rank 64 per head (ridge λ=0.01)
2025-05-01 19:24:56,252 - INFO - [QK] Compressed layer 27 to rank 64 per head (ridge λ=0.01)
2025-05-01 19:25:16,426 - INFO - [QK] Compressed layer 28 to rank 64 per head (ridge λ=0.01)
2025-05-01 19:25:39,768 - INFO - [QK] Compressed layer 29 to rank 64 per head (ridge λ=0.01)
2025-05-01 19:26:03,051 - INFO - [QK] Compressed layer 30 to rank 64 per head (ridge λ=0.01)
2025-05-01 19:26:22,572 - INFO - [QK] Compressed layer 31 to rank 64 per head (ridge λ=0.01)
2025-05-01 19:26:29,770 - INFO - [VO] Compressed layer 0 to rank 792 (Type-III SVD)
2025-05-01 19:26:37,144 - INFO - [VO] Compressed layer 1 to rank 2080 (Type-III SVD)
2025-05-01 19:26:44,831 - INFO - [VO] Compressed layer 2 to rank 2101 (Type-III SVD)
2025-05-01 19:26:52,249 - INFO - [VO] Compressed layer 3 to rank 2102 (Type-III SVD)
2025-05-01 19:26:59,458 - INFO - [VO] Compressed layer 4 to rank 2102 (Type-III SVD)
2025-05-01 19:27:06,650 - INFO - [VO] Compressed layer 5 to rank 2102 (Type-III SVD)
2025-05-01 19:27:14,049 - INFO - [VO] Compressed layer 6 to rank 2102 (Type-III SVD)
2025-05-01 19:27:21,252 - INFO - [VO] Compressed layer 7 to rank 2101 (Type-III SVD)
2025-05-01 19:27:28,678 - INFO - [VO] Compressed layer 8 to rank 2101 (Type-III SVD)
2025-05-01 19:27:36,328 - INFO - [VO] Compressed layer 9 to rank 2101 (Type-III SVD)
2025-05-01 19:27:43,809 - INFO - [VO] Compressed layer 10 to rank 2101 (Type-III SVD)
2025-05-01 19:27:51,273 - INFO - [VO] Compressed layer 11 to rank 2101 (Type-III SVD)
2025-05-01 19:27:58,799 - INFO - [VO] Compressed layer 12 to rank 2101 (Type-III SVD)
2025-05-01 19:28:06,166 - INFO - [VO] Compressed layer 13 to rank 2101 (Type-III SVD)
2025-05-01 19:28:13,912 - INFO - [VO] Compressed layer 14 to rank 2100 (Type-III SVD)
2025-05-01 19:28:21,590 - INFO - [VO] Compressed layer 15 to rank 2100 (Type-III SVD)
2025-05-01 19:28:28,952 - INFO - [VO] Compressed layer 16 to rank 2098 (Type-III SVD)
2025-05-01 19:28:36,645 - INFO - [VO] Compressed layer 17 to rank 2097 (Type-III SVD)
2025-05-01 19:28:44,416 - INFO - [VO] Compressed layer 18 to rank 2096 (Type-III SVD)
2025-05-01 19:28:51,688 - INFO - [VO] Compressed layer 19 to rank 2093 (Type-III SVD)
2025-05-01 19:28:59,229 - INFO - [VO] Compressed layer 20 to rank 2092 (Type-III SVD)
2025-05-01 19:29:06,920 - INFO - [VO] Compressed layer 21 to rank 2087 (Type-III SVD)
2025-05-01 19:29:14,311 - INFO - [VO] Compressed layer 22 to rank 2085 (Type-III SVD)
2025-05-01 19:29:21,960 - INFO - [VO] Compressed layer 23 to rank 2075 (Type-III SVD)
2025-05-01 19:29:29,526 - INFO - [VO] Compressed layer 24 to rank 2069 (Type-III SVD)
2025-05-01 19:29:37,099 - INFO - [VO] Compressed layer 25 to rank 2059 (Type-III SVD)
2025-05-01 19:29:44,553 - INFO - [VO] Compressed layer 26 to rank 2054 (Type-III SVD)
2025-05-01 19:29:52,033 - INFO - [VO] Compressed layer 27 to rank 2068 (Type-III SVD)
2025-05-01 19:29:59,509 - INFO - [VO] Compressed layer 28 to rank 2071 (Type-III SVD)
2025-05-01 19:30:06,926 - INFO - [VO] Compressed layer 29 to rank 2071 (Type-III SVD)
2025-05-01 19:30:14,373 - INFO - [VO] Compressed layer 30 to rank 2068 (Type-III SVD)
2025-05-01 19:30:21,929 - INFO - [VO] Compressed layer 31 to rank 2049 (Type-III SVD)
2025-05-01 19:30:21,930 - INFO - Saving compressed model...
2025-05-01 19:32:25,629 - INFO - ✔ Model, tokenizer, and tokenizer_source.txt saved to compressed_output/opt-6.7b
2025-05-01 19:32:25,631 - INFO - Reloading compressed model for evaluation...
2025-05-01 19:32:25,631 - INFO - Reloading compressed model from: compressed_output/opt-6.7b
2025-05-01 19:32:30,659 - WARNING - [Reload fallback] device_map failed: Device cuda:0 is not recognized, available devices are integers(for GPU/XPU), 'mps', 'cpu' and 'disk'
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  6.95it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  6.93it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  7.37it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  7.24it/s]
2025-05-01 19:32:35,969 - INFO - ✔ Reloaded compressed model and tokenizer successfully.
2025-05-01 19:32:41,310 - INFO - Compressed model perplexity on WikiText2: 4457.48
