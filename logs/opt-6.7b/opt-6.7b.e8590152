2025-05-01 21:46:23,788 - INFO - Loading model: facebook/opt-6.7b
2025-05-01 21:46:23,789 - INFO - Loading model from: facebook/opt-6.7b
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  4.79it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.83it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.64it/s]
2025-05-01 21:46:32,587 - INFO - ✔ Loaded model on cuda:0 with float16.
2025-05-01 21:46:32,589 - INFO - Loading calibration and evaluation texts...
2025-05-01 21:46:41,457 - INFO - Evaluating original model (for baseline perplexity)...
2025-05-01 21:48:27,066 - INFO - Original model perplexity on WikiText2: 10.29
2025-05-01 21:48:27,067 - INFO - Calibrating model...
2025-05-01 21:48:27,067 - INFO - Detected architecture: opt
2025-05-01 21:50:41,568 - INFO - Finished calibration and computed BI scores.
2025-05-01 21:50:41,571 - INFO - Allocating layer sparsity...
2025-05-01 21:50:41,572 - INFO - Allocating global sparsity using target keep ratio 0.5000 and temperature 1.0
2025-05-01 21:50:41,572 - INFO - Layer  0: keep_ratio = 1.0000 (BI = 0.9506)
2025-05-01 21:50:41,572 - INFO - Layer  1: keep_ratio = 0.4839 (BI = 0.0167)
2025-05-01 21:50:41,572 - INFO - Layer  2: keep_ratio = 0.4908 (BI = 0.0027)
2025-05-01 21:50:41,572 - INFO - Layer  3: keep_ratio = 0.4913 (BI = 0.0017)
2025-05-01 21:50:41,572 - INFO - Layer  4: keep_ratio = 0.4913 (BI = 0.0016)
2025-05-01 21:50:41,572 - INFO - Layer  5: keep_ratio = 0.4912 (BI = 0.0019)
2025-05-01 21:50:41,572 - INFO - Layer  6: keep_ratio = 0.4909 (BI = 0.0024)
2025-05-01 21:50:41,572 - INFO - Layer  7: keep_ratio = 0.4907 (BI = 0.0028)
2025-05-01 21:50:41,572 - INFO - Layer  8: keep_ratio = 0.4903 (BI = 0.0037)
2025-05-01 21:50:41,572 - INFO - Layer  9: keep_ratio = 0.4896 (BI = 0.0050)
2025-05-01 21:50:41,572 - INFO - Layer 10: keep_ratio = 0.4893 (BI = 0.0057)
2025-05-01 21:50:41,572 - INFO - Layer 11: keep_ratio = 0.4885 (BI = 0.0073)
2025-05-01 21:50:41,572 - INFO - Layer 12: keep_ratio = 0.4879 (BI = 0.0086)
2025-05-01 21:50:41,572 - INFO - Layer 13: keep_ratio = 0.4871 (BI = 0.0103)
2025-05-01 21:50:41,572 - INFO - Layer 14: keep_ratio = 0.4862 (BI = 0.0121)
2025-05-01 21:50:41,572 - INFO - Layer 15: keep_ratio = 0.4847 (BI = 0.0152)
2025-05-01 21:50:41,572 - INFO - Layer 16: keep_ratio = 0.4833 (BI = 0.0180)
2025-05-01 21:50:41,572 - INFO - Layer 17: keep_ratio = 0.4822 (BI = 0.0204)
2025-05-01 21:50:41,572 - INFO - Layer 18: keep_ratio = 0.4811 (BI = 0.0227)
2025-05-01 21:50:41,572 - INFO - Layer 19: keep_ratio = 0.4798 (BI = 0.0253)
2025-05-01 21:50:41,572 - INFO - Layer 20: keep_ratio = 0.4792 (BI = 0.0266)
2025-05-01 21:50:41,572 - INFO - Layer 21: keep_ratio = 0.4773 (BI = 0.0304)
2025-05-01 21:50:41,572 - INFO - Layer 22: keep_ratio = 0.4786 (BI = 0.0279)
2025-05-01 21:50:41,572 - INFO - Layer 23: keep_ratio = 0.4762 (BI = 0.0329)
2025-05-01 21:50:41,572 - INFO - Layer 24: keep_ratio = 0.4770 (BI = 0.0312)
2025-05-01 21:50:41,572 - INFO - Layer 25: keep_ratio = 0.4768 (BI = 0.0315)
2025-05-01 21:50:41,572 - INFO - Layer 26: keep_ratio = 0.4766 (BI = 0.0319)
2025-05-01 21:50:41,572 - INFO - Layer 27: keep_ratio = 0.4782 (BI = 0.0287)
2025-05-01 21:50:41,572 - INFO - Layer 28: keep_ratio = 0.4800 (BI = 0.0250)
2025-05-01 21:50:41,572 - INFO - Layer 29: keep_ratio = 0.4808 (BI = 0.0233)
2025-05-01 21:50:41,572 - INFO - Layer 30: keep_ratio = 0.4800 (BI = 0.0248)
2025-05-01 21:50:41,572 - INFO - Layer 31: keep_ratio = 0.4794 (BI = 0.0261)
2025-05-01 21:50:41,573 - INFO - Freeing original model from GPU before compression...
2025-05-01 21:50:44,160 - INFO - n_layers=32, n_heads=32, d_model=4096, head_dim=128
2025-05-01 21:50:44,160 - INFO - Applying MoDeGPT compression methods...
2025-05-01 21:56:19,673 - INFO - [MLP] Compressed layer 0 to rank 16384 (Nyström, λ=0.01)
2025-05-01 21:58:00,028 - INFO - [MLP] Compressed layer 1 to rank 7928 (Nyström, λ=0.01)
2025-05-01 21:59:56,969 - INFO - [MLP] Compressed layer 2 to rank 8040 (Nyström, λ=0.01)
2025-05-01 22:01:46,886 - INFO - [MLP] Compressed layer 3 to rank 8048 (Nyström, λ=0.01)
2025-05-01 22:03:43,738 - INFO - [MLP] Compressed layer 4 to rank 8049 (Nyström, λ=0.01)
2025-05-01 22:05:41,598 - INFO - [MLP] Compressed layer 5 to rank 8047 (Nyström, λ=0.01)
2025-05-01 22:07:43,854 - INFO - [MLP] Compressed layer 6 to rank 8043 (Nyström, λ=0.01)
2025-05-01 22:09:43,343 - INFO - [MLP] Compressed layer 7 to rank 8040 (Nyström, λ=0.01)
2025-05-01 22:11:38,980 - INFO - [MLP] Compressed layer 8 to rank 8032 (Nyström, λ=0.01)
2025-05-01 22:13:34,867 - INFO - [MLP] Compressed layer 9 to rank 8022 (Nyström, λ=0.01)
2025-05-01 22:15:30,978 - INFO - [MLP] Compressed layer 10 to rank 8016 (Nyström, λ=0.01)
2025-05-01 22:17:32,379 - INFO - [MLP] Compressed layer 11 to rank 8004 (Nyström, λ=0.01)
2025-05-01 22:19:23,807 - INFO - [MLP] Compressed layer 12 to rank 7993 (Nyström, λ=0.01)
2025-05-01 22:21:18,929 - INFO - [MLP] Compressed layer 13 to rank 7980 (Nyström, λ=0.01)
2025-05-01 22:23:18,116 - INFO - [MLP] Compressed layer 14 to rank 7965 (Nyström, λ=0.01)
2025-05-01 22:25:13,597 - INFO - [MLP] Compressed layer 15 to rank 7941 (Nyström, λ=0.01)
2025-05-01 22:27:10,241 - INFO - [MLP] Compressed layer 16 to rank 7918 (Nyström, λ=0.01)
2025-05-01 22:29:06,402 - INFO - [MLP] Compressed layer 17 to rank 7899 (Nyström, λ=0.01)
2025-05-01 22:31:01,572 - INFO - [MLP] Compressed layer 18 to rank 7881 (Nyström, λ=0.01)
2025-05-01 22:32:49,044 - INFO - [MLP] Compressed layer 19 to rank 7860 (Nyström, λ=0.01)
2025-05-01 22:34:44,751 - INFO - [MLP] Compressed layer 20 to rank 7850 (Nyström, λ=0.01)
2025-05-01 22:36:39,703 - INFO - [MLP] Compressed layer 21 to rank 7820 (Nyström, λ=0.01)
2025-05-01 22:38:39,231 - INFO - [MLP] Compressed layer 22 to rank 7841 (Nyström, λ=0.01)
2025-05-01 22:40:28,387 - INFO - [MLP] Compressed layer 23 to rank 7801 (Nyström, λ=0.01)
2025-05-01 22:42:25,552 - INFO - [MLP] Compressed layer 24 to rank 7814 (Nyström, λ=0.01)
2025-05-01 22:44:18,644 - INFO - [MLP] Compressed layer 25 to rank 7812 (Nyström, λ=0.01)
2025-05-01 22:46:14,220 - INFO - [MLP] Compressed layer 26 to rank 7809 (Nyström, λ=0.01)
2025-05-01 22:48:11,211 - INFO - [MLP] Compressed layer 27 to rank 7834 (Nyström, λ=0.01)
2025-05-01 22:50:05,720 - INFO - [MLP] Compressed layer 28 to rank 7863 (Nyström, λ=0.01)
2025-05-01 22:51:58,383 - INFO - [MLP] Compressed layer 29 to rank 7876 (Nyström, λ=0.01)
2025-05-01 22:53:51,235 - INFO - [MLP] Compressed layer 30 to rank 7864 (Nyström, λ=0.01)
2025-05-01 22:55:50,147 - INFO - [MLP] Compressed layer 31 to rank 7854 (Nyström, λ=0.01)
2025-05-01 22:56:13,588 - INFO - [QK] Compressed layer 0 to rank 128 per head (ridge λ=0.01)
2025-05-01 22:56:36,950 - INFO - [QK] Compressed layer 1 to rank 61 per head (ridge λ=0.01)
2025-05-01 22:56:58,251 - INFO - [QK] Compressed layer 2 to rank 62 per head (ridge λ=0.01)
2025-05-01 22:57:21,573 - INFO - [QK] Compressed layer 3 to rank 62 per head (ridge λ=0.01)
2025-05-01 22:57:44,826 - INFO - [QK] Compressed layer 4 to rank 62 per head (ridge λ=0.01)
2025-05-01 22:58:06,529 - INFO - [QK] Compressed layer 5 to rank 62 per head (ridge λ=0.01)
2025-05-01 22:58:29,681 - INFO - [QK] Compressed layer 6 to rank 62 per head (ridge λ=0.01)
2025-05-01 22:58:51,330 - INFO - [QK] Compressed layer 7 to rank 62 per head (ridge λ=0.01)
2025-05-01 22:59:12,676 - INFO - [QK] Compressed layer 8 to rank 62 per head (ridge λ=0.01)
2025-05-01 22:59:33,885 - INFO - [QK] Compressed layer 9 to rank 62 per head (ridge λ=0.01)
2025-05-01 22:59:56,442 - INFO - [QK] Compressed layer 10 to rank 62 per head (ridge λ=0.01)
2025-05-01 23:00:19,608 - INFO - [QK] Compressed layer 11 to rank 62 per head (ridge λ=0.01)
2025-05-01 23:00:41,433 - INFO - [QK] Compressed layer 12 to rank 62 per head (ridge λ=0.01)
2025-05-01 23:01:04,580 - INFO - [QK] Compressed layer 13 to rank 62 per head (ridge λ=0.01)
2025-05-01 23:01:27,825 - INFO - [QK] Compressed layer 14 to rank 62 per head (ridge λ=0.01)
2025-05-01 23:01:49,194 - INFO - [QK] Compressed layer 15 to rank 62 per head (ridge λ=0.01)
2025-05-01 23:02:12,426 - INFO - [QK] Compressed layer 16 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:02:35,543 - INFO - [QK] Compressed layer 17 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:02:55,071 - INFO - [QK] Compressed layer 18 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:03:18,242 - INFO - [QK] Compressed layer 19 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:03:41,435 - INFO - [QK] Compressed layer 20 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:04:01,255 - INFO - [QK] Compressed layer 21 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:04:24,440 - INFO - [QK] Compressed layer 22 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:04:47,642 - INFO - [QK] Compressed layer 23 to rank 60 per head (ridge λ=0.01)
2025-05-01 23:05:07,271 - INFO - [QK] Compressed layer 24 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:05:30,437 - INFO - [QK] Compressed layer 25 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:05:53,661 - INFO - [QK] Compressed layer 26 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:06:13,549 - INFO - [QK] Compressed layer 27 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:06:36,737 - INFO - [QK] Compressed layer 28 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:06:59,502 - INFO - [QK] Compressed layer 29 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:07:19,189 - INFO - [QK] Compressed layer 30 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:07:39,037 - INFO - [QK] Compressed layer 31 to rank 61 per head (ridge λ=0.01)
2025-05-01 23:07:46,203 - INFO - [VO] Compressed layer 0 to rank 4096 (Type-III SVD)
2025-05-01 23:07:53,478 - INFO - [VO] Compressed layer 1 to rank 1982 (Type-III SVD)
2025-05-01 23:08:01,126 - INFO - [VO] Compressed layer 2 to rank 2010 (Type-III SVD)
2025-05-01 23:08:08,511 - INFO - [VO] Compressed layer 3 to rank 2012 (Type-III SVD)
2025-05-01 23:08:15,784 - INFO - [VO] Compressed layer 4 to rank 2012 (Type-III SVD)
2025-05-01 23:08:22,999 - INFO - [VO] Compressed layer 5 to rank 2011 (Type-III SVD)
2025-05-01 23:08:30,437 - INFO - [VO] Compressed layer 6 to rank 2010 (Type-III SVD)
2025-05-01 23:08:37,682 - INFO - [VO] Compressed layer 7 to rank 2010 (Type-III SVD)
2025-05-01 23:08:45,139 - INFO - [VO] Compressed layer 8 to rank 2008 (Type-III SVD)
2025-05-01 23:08:52,888 - INFO - [VO] Compressed layer 9 to rank 2005 (Type-III SVD)
2025-05-01 23:09:00,350 - INFO - [VO] Compressed layer 10 to rank 2004 (Type-III SVD)
2025-05-01 23:09:07,844 - INFO - [VO] Compressed layer 11 to rank 2001 (Type-III SVD)
2025-05-01 23:09:15,424 - INFO - [VO] Compressed layer 12 to rank 1998 (Type-III SVD)
2025-05-01 23:09:22,812 - INFO - [VO] Compressed layer 13 to rank 1995 (Type-III SVD)
2025-05-01 23:09:30,615 - INFO - [VO] Compressed layer 14 to rank 1991 (Type-III SVD)
2025-05-01 23:09:38,344 - INFO - [VO] Compressed layer 15 to rank 1985 (Type-III SVD)
2025-05-01 23:09:45,704 - INFO - [VO] Compressed layer 16 to rank 1979 (Type-III SVD)
2025-05-01 23:09:53,416 - INFO - [VO] Compressed layer 17 to rank 1974 (Type-III SVD)
2025-05-01 23:10:01,133 - INFO - [VO] Compressed layer 18 to rank 1970 (Type-III SVD)
2025-05-01 23:10:08,414 - INFO - [VO] Compressed layer 19 to rank 1965 (Type-III SVD)
2025-05-01 23:10:15,960 - INFO - [VO] Compressed layer 20 to rank 1962 (Type-III SVD)
2025-05-01 23:10:23,607 - INFO - [VO] Compressed layer 21 to rank 1955 (Type-III SVD)
2025-05-01 23:10:30,993 - INFO - [VO] Compressed layer 22 to rank 1960 (Type-III SVD)
2025-05-01 23:10:38,698 - INFO - [VO] Compressed layer 23 to rank 1950 (Type-III SVD)
2025-05-01 23:10:46,215 - INFO - [VO] Compressed layer 24 to rank 1953 (Type-III SVD)
2025-05-01 23:10:53,734 - INFO - [VO] Compressed layer 25 to rank 1953 (Type-III SVD)
2025-05-01 23:11:01,123 - INFO - [VO] Compressed layer 26 to rank 1952 (Type-III SVD)
2025-05-01 23:11:08,621 - INFO - [VO] Compressed layer 27 to rank 1958 (Type-III SVD)
2025-05-01 23:11:16,072 - INFO - [VO] Compressed layer 28 to rank 1965 (Type-III SVD)
2025-05-01 23:11:23,464 - INFO - [VO] Compressed layer 29 to rank 1969 (Type-III SVD)
2025-05-01 23:11:30,935 - INFO - [VO] Compressed layer 30 to rank 1966 (Type-III SVD)
2025-05-01 23:11:38,459 - INFO - [VO] Compressed layer 31 to rank 1963 (Type-III SVD)
2025-05-01 23:11:38,459 - INFO - Saving compressed model...
2025-05-01 23:13:39,507 - INFO - ✔ Model, tokenizer, and tokenizer_source.txt saved to /u/scratch/x/xxiong/compressed_output/opt-6.7b
2025-05-01 23:13:39,510 - INFO - Reloading compressed model for evaluation...
2025-05-01 23:13:39,510 - INFO - Reloading compressed model from: /u/scratch/x/xxiong/compressed_output/opt-6.7b
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  5.42it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  5.71it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  5.85it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  5.78it/s]
2025-05-01 23:13:45,165 - INFO - ✔ Reloaded compressed model to cuda:0 successfully.
2025-05-01 23:15:30,228 - INFO - Compressed model perplexity on WikiText2: 3158.73
