2025-04-30 19:41:01,282 - INFO - Loading model: facebook/opt-6.7b
2025-04-30 19:41:01,283 - INFO - Loading model from: facebook/opt-6.7b
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:03<00:03,  3.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:03<00:00,  1.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:03<00:00,  1.97s/it]
2025-04-30 19:41:14,813 - INFO - ✔ Loaded with device_map='auto', float16, low_cpu_mem_usage=True.
2025-04-30 19:41:14,815 - INFO - Loading calibration and evaluation texts...
2025-04-30 19:41:28,608 - INFO - Evaluating original model (for baseline perplexity)...
2025-04-30 19:41:35,834 - INFO - Original model perplexity on WikiText2: 8.47
2025-04-30 19:41:35,835 - INFO - Calibrating model...
2025-04-30 19:41:35,835 - INFO - Detected architecture: opt
2025-04-30 19:42:32,081 - INFO - Finished calibration and computed BI scores.
2025-04-30 19:42:32,085 - INFO - Allocating layer sparsity...
2025-04-30 19:42:32,085 - INFO - Allocating global sparsity using target keep ratio 0.5000 and temperature 1.0
2025-04-30 19:42:32,085 - INFO - Layer  0: keep_ratio = 0.5000 (BI = -0.0000)
2025-04-30 19:42:32,085 - INFO - Layer  1: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer  2: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer  3: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer  4: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer  5: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer  6: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer  7: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer  8: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer  9: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 10: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 11: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 12: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 13: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 14: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 15: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 16: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 17: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 18: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 19: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 20: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 21: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 22: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,085 - INFO - Layer 23: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,086 - INFO - Layer 24: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,086 - INFO - Layer 25: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,086 - INFO - Layer 26: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,086 - INFO - Layer 27: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,086 - INFO - Layer 28: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,086 - INFO - Layer 29: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,086 - INFO - Layer 30: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,086 - INFO - Layer 31: keep_ratio = 0.5000 (BI = 0.0000)
2025-04-30 19:42:32,086 - INFO - Freeing original model from GPU before compression...
2025-04-30 19:42:36,344 - INFO - n_layers=32, n_heads=32, d_model=4096, head_dim=128
2025-04-30 19:42:36,344 - INFO - Applying MoDeGPT compression methods...
2025-04-30 19:47:27,516 - INFO - [MLP] Compressed layer 0 to rank 8192 (Nyström, λ=0.01)
2025-04-30 19:51:56,613 - INFO - [MLP] Compressed layer 1 to rank 8192 (Nyström, λ=0.01)
2025-04-30 19:56:59,929 - INFO - [MLP] Compressed layer 2 to rank 8192 (Nyström, λ=0.01)
2025-04-30 20:01:36,127 - INFO - [MLP] Compressed layer 3 to rank 8192 (Nyström, λ=0.01)
2025-04-30 20:06:38,051 - INFO - [MLP] Compressed layer 4 to rank 8192 (Nyström, λ=0.01)
2025-04-30 20:11:45,635 - INFO - [MLP] Compressed layer 5 to rank 8192 (Nyström, λ=0.01)
2025-04-30 20:17:09,444 - INFO - [MLP] Compressed layer 6 to rank 8192 (Nyström, λ=0.01)
2025-04-30 20:22:29,960 - INFO - [MLP] Compressed layer 7 to rank 8192 (Nyström, λ=0.01)
2025-04-30 20:28:13,370 - INFO - [MLP] Compressed layer 8 to rank 8192 (Nyström, λ=0.01)
2025-04-30 20:34:09,466 - INFO - [MLP] Compressed layer 9 to rank 8192 (Nyström, λ=0.01)
2025-04-30 20:40:22,418 - INFO - [MLP] Compressed layer 10 to rank 8192 (Nyström, λ=0.01)
2025-04-30 20:45:30,152 - INFO - [MLP] Compressed layer 11 to rank 8192 (Nyström, λ=0.01)
2025-04-30 20:49:08,581 - INFO - [MLP] Compressed layer 12 to rank 8192 (Nyström, λ=0.01)
2025-04-30 20:53:18,114 - INFO - [MLP] Compressed layer 13 to rank 8192 (Nyström, λ=0.01)
2025-04-30 20:57:52,841 - INFO - [MLP] Compressed layer 14 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:02:23,437 - INFO - [MLP] Compressed layer 15 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:06:42,104 - INFO - [MLP] Compressed layer 16 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:10:56,648 - INFO - [MLP] Compressed layer 17 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:15:06,592 - INFO - [MLP] Compressed layer 18 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:18:57,646 - INFO - [MLP] Compressed layer 19 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:22:38,789 - INFO - [MLP] Compressed layer 20 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:25:57,798 - INFO - [MLP] Compressed layer 21 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:29:25,452 - INFO - [MLP] Compressed layer 22 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:32:48,006 - INFO - [MLP] Compressed layer 23 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:36:14,470 - INFO - [MLP] Compressed layer 24 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:38:49,579 - INFO - [MLP] Compressed layer 25 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:41:39,486 - INFO - [MLP] Compressed layer 26 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:44:26,466 - INFO - [MLP] Compressed layer 27 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:47:00,632 - INFO - [MLP] Compressed layer 28 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:49:49,635 - INFO - [MLP] Compressed layer 29 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:52:23,146 - INFO - [MLP] Compressed layer 30 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:55:09,796 - INFO - [MLP] Compressed layer 31 to rank 8192 (Nyström, λ=0.01)
2025-04-30 21:55:42,644 - INFO - [QK] Compressed layer 0 to rank 64 per head (ridge λ=0.01)
2025-04-30 21:56:17,979 - INFO - [QK] Compressed layer 1 to rank 64 per head (ridge λ=0.01)
2025-04-30 21:56:53,213 - INFO - [QK] Compressed layer 2 to rank 64 per head (ridge λ=0.01)
2025-04-30 21:57:27,766 - INFO - [QK] Compressed layer 3 to rank 64 per head (ridge λ=0.01)
2025-04-30 21:57:54,067 - INFO - [QK] Compressed layer 4 to rank 64 per head (ridge λ=0.01)
2025-04-30 21:58:17,071 - INFO - [QK] Compressed layer 5 to rank 64 per head (ridge λ=0.01)
2025-04-30 21:58:40,153 - INFO - [QK] Compressed layer 6 to rank 64 per head (ridge λ=0.01)
2025-04-30 21:59:09,207 - INFO - [QK] Compressed layer 7 to rank 64 per head (ridge λ=0.01)
2025-04-30 21:59:44,369 - INFO - [QK] Compressed layer 8 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:00:19,549 - INFO - [QK] Compressed layer 9 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:00:54,534 - INFO - [QK] Compressed layer 10 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:01:21,608 - INFO - [QK] Compressed layer 11 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:01:45,658 - INFO - [QK] Compressed layer 12 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:02:09,730 - INFO - [QK] Compressed layer 13 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:02:38,531 - INFO - [QK] Compressed layer 14 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:03:13,669 - INFO - [QK] Compressed layer 15 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:03:48,765 - INFO - [QK] Compressed layer 16 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:04:22,394 - INFO - [QK] Compressed layer 17 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:04:46,438 - INFO - [QK] Compressed layer 18 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:05:10,477 - INFO - [QK] Compressed layer 19 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:05:34,537 - INFO - [QK] Compressed layer 20 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:06:07,527 - INFO - [QK] Compressed layer 21 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:06:42,654 - INFO - [QK] Compressed layer 22 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:07:17,581 - INFO - [QK] Compressed layer 23 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:07:44,921 - INFO - [QK] Compressed layer 24 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:08:08,974 - INFO - [QK] Compressed layer 25 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:08:33,038 - INFO - [QK] Compressed layer 26 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:09:01,345 - INFO - [QK] Compressed layer 27 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:09:36,469 - INFO - [QK] Compressed layer 28 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:10:11,441 - INFO - [QK] Compressed layer 29 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:10:37,500 - INFO - [QK] Compressed layer 30 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:11:01,004 - INFO - [QK] Compressed layer 31 to rank 64 per head (ridge λ=0.01)
2025-04-30 22:11:01,006 - WARNING - [VO] Compression failed at layer 0: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,006 - WARNING - [VO] Compression failed at layer 1: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 2: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 3: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 4: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 5: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 6: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 7: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 8: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 9: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 10: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 11: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 12: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 13: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 14: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 15: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 16: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 17: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 18: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 19: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 20: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 21: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,007 - WARNING - [VO] Compression failed at layer 22: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,008 - WARNING - [VO] Compression failed at layer 23: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,008 - WARNING - [VO] Compression failed at layer 24: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,008 - WARNING - [VO] Compression failed at layer 25: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,008 - WARNING - [VO] Compression failed at layer 26: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,008 - WARNING - [VO] Compression failed at layer 27: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,008 - WARNING - [VO] Compression failed at layer 28: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,008 - WARNING - [VO] Compression failed at layer 29: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,008 - WARNING - [VO] Compression failed at layer 30: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,008 - WARNING - [VO] Compression failed at layer 31: to() received an invalid combination of arguments - got (torch.dtype, device=str), but expected one of:
 * (torch.device device = None, torch.dtype dtype = None, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (torch.dtype dtype, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)
 * (Tensor tensor, bool non_blocking = False, bool copy = False, *, torch.memory_format memory_format = None)

2025-04-30 22:11:01,008 - INFO - Saving compressed model...
2025-04-30 22:13:07,400 - INFO - ✔ Model, tokenizer, and tokenizer_source.txt saved to compressed_output/opt-6.7b
2025-04-30 22:13:07,412 - INFO - Reloading compressed model for evaluation...
2025-04-30 22:13:07,413 - INFO - Reloading compressed model from: compressed_output/opt-6.7b
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:03,  1.80s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:03<00:01,  1.65s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:04<00:00,  1.41s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:04<00:00,  1.49s/it]
2025-04-30 22:13:12,359 - INFO - ✔ Reloaded compressed model and tokenizer successfully.
2025-04-30 22:13:17,432 - INFO - Compressed model perplexity on WikiText2: 25.50
Traceback (most recent call last):
  File "/u/home/x/xxiong/MoDeGPT/run_modegpt.py", line 354, in <module>
    main()
  File "/u/home/x/xxiong/MoDeGPT/run_modegpt.py", line 349, in main
    results = evaluate_zero_shot(compressed_model, tokenizer, device=device)
  File "/u/home/x/xxiong/MoDeGPT/evaluation.py", line 89, in evaluate_zero_shot
    continuation = generate_text(model, tokenizer, prompt, max_length=30, device=device)
  File "/u/home/x/xxiong/miniforge3/envs/modegpt/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/u/home/x/xxiong/MoDeGPT/evaluation.py", line 62, in generate_text
    inputs = tokenizer(
  File "/u/home/x/xxiong/miniforge3/envs/modegpt/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 2883, in __call__
    encodings = self._call_one(text=text, text_pair=text_pair, **all_kwargs)
  File "/u/home/x/xxiong/miniforge3/envs/modegpt/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 2989, in _call_one
    return self.encode_plus(
  File "/u/home/x/xxiong/miniforge3/envs/modegpt/lib/python3.10/site-packages/transformers/tokenization_utils_base.py", line 3062, in encode_plus
    return self._encode_plus(
  File "/u/home/x/xxiong/miniforge3/envs/modegpt/lib/python3.10/site-packages/transformers/models/gpt2/tokenization_gpt2_fast.py", line 138, in _encode_plus
    return super()._encode_plus(*args, **kwargs)
  File "/u/home/x/xxiong/miniforge3/envs/modegpt/lib/python3.10/site-packages/transformers/tokenization_utils_fast.py", line 583, in _encode_plus
    batched_output = self._batch_encode_plus(
  File "/u/home/x/xxiong/miniforge3/envs/modegpt/lib/python3.10/site-packages/transformers/models/gpt2/tokenization_gpt2_fast.py", line 128, in _batch_encode_plus
    return super()._batch_encode_plus(*args, **kwargs)
  File "/u/home/x/xxiong/miniforge3/envs/modegpt/lib/python3.10/site-packages/transformers/tokenization_utils_fast.py", line 503, in _batch_encode_plus
    self.set_truncation_and_padding(
  File "/u/home/x/xxiong/miniforge3/envs/modegpt/lib/python3.10/site-packages/transformers/tokenization_utils_fast.py", line 458, in set_truncation_and_padding
    self._tokenizer.enable_truncation(**target)
OverflowError: int too big to convert
