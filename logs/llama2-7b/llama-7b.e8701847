2025-05-03 03:01:45,857 - INFO - Loading model: meta-llama/Llama-2-7b-hf
2025-05-03 03:01:45,857 - INFO - Loading model from: meta-llama/Llama-2-7b-hf
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  9.17it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00, 10.73it/s]
2025-05-03 03:01:56,365 - INFO - ✔ Loaded model on cuda:0 with float16.
2025-05-03 03:01:56,366 - INFO - No pad_token found. Set pad_token = eos_token.
2025-05-03 03:01:56,367 - INFO - Loading calibration and evaluation texts...
2025-05-03 03:02:09,383 - INFO - Evaluating original model (for baseline perplexity)...
2025-05-03 03:03:03,549 - INFO - Original model perplexity on WikiText2: 5.72
2025-05-03 03:03:03,550 - INFO - Calibrating model...
2025-05-03 03:03:03,550 - INFO - Detected architecture: llama
2025-05-03 03:04:35,155 - INFO - Finished calibration and computed BI scores.
2025-05-03 03:04:35,157 - INFO - Allocating layer sparsity...
2025-05-03 03:04:35,157 - INFO - Allocating global sparsity using target keep ratio 0.5000 and temperature 1.0
2025-05-03 03:04:35,157 - INFO - Layer  0: keep_ratio = 1.0000 (BI = 0.4532)
2025-05-03 03:04:35,157 - INFO - Layer  1: keep_ratio = 0.3774 (BI = 0.3471)
2025-05-03 03:04:35,157 - INFO - Layer  2: keep_ratio = 0.4513 (BI = 0.1683)
2025-05-03 03:04:35,157 - INFO - Layer  3: keep_ratio = 0.4585 (BI = 0.1526)
2025-05-03 03:04:35,157 - INFO - Layer  4: keep_ratio = 0.4563 (BI = 0.1575)
2025-05-03 03:04:35,157 - INFO - Layer  5: keep_ratio = 0.4629 (BI = 0.1431)
2025-05-03 03:04:35,157 - INFO - Layer  6: keep_ratio = 0.4640 (BI = 0.1407)
2025-05-03 03:04:35,157 - INFO - Layer  7: keep_ratio = 0.4671 (BI = 0.1339)
2025-05-03 03:04:35,157 - INFO - Layer  8: keep_ratio = 0.4736 (BI = 0.1201)
2025-05-03 03:04:35,157 - INFO - Layer  9: keep_ratio = 0.4782 (BI = 0.1105)
2025-05-03 03:04:35,157 - INFO - Layer 10: keep_ratio = 0.4819 (BI = 0.1027)
2025-05-03 03:04:35,157 - INFO - Layer 11: keep_ratio = 0.4873 (BI = 0.0916)
2025-05-03 03:04:35,157 - INFO - Layer 12: keep_ratio = 0.4869 (BI = 0.0925)
2025-05-03 03:04:35,157 - INFO - Layer 13: keep_ratio = 0.4864 (BI = 0.0936)
2025-05-03 03:04:35,157 - INFO - Layer 14: keep_ratio = 0.4904 (BI = 0.0853)
2025-05-03 03:04:35,157 - INFO - Layer 15: keep_ratio = 0.4856 (BI = 0.0952)
2025-05-03 03:04:35,157 - INFO - Layer 16: keep_ratio = 0.4893 (BI = 0.0876)
2025-05-03 03:04:35,157 - INFO - Layer 17: keep_ratio = 0.4964 (BI = 0.0731)
2025-05-03 03:04:35,157 - INFO - Layer 18: keep_ratio = 0.4998 (BI = 0.0663)
2025-05-03 03:04:35,157 - INFO - Layer 19: keep_ratio = 0.5058 (BI = 0.0543)
2025-05-03 03:04:35,157 - INFO - Layer 20: keep_ratio = 0.5073 (BI = 0.0514)
2025-05-03 03:04:35,158 - INFO - Layer 21: keep_ratio = 0.5130 (BI = 0.0403)
2025-05-03 03:04:35,158 - INFO - Layer 22: keep_ratio = 0.5135 (BI = 0.0393)
2025-05-03 03:04:35,158 - INFO - Layer 23: keep_ratio = 0.5170 (BI = 0.0324)
2025-05-03 03:04:35,158 - INFO - Layer 24: keep_ratio = 0.5174 (BI = 0.0317)
2025-05-03 03:04:35,158 - INFO - Layer 25: keep_ratio = 0.5174 (BI = 0.0317)
2025-05-03 03:04:35,158 - INFO - Layer 26: keep_ratio = 0.5186 (BI = 0.0295)
2025-05-03 03:04:35,158 - INFO - Layer 27: keep_ratio = 0.5191 (BI = 0.0284)
2025-05-03 03:04:35,158 - INFO - Layer 28: keep_ratio = 0.5180 (BI = 0.0306)
2025-05-03 03:04:35,158 - INFO - Layer 29: keep_ratio = 0.5170 (BI = 0.0326)
2025-05-03 03:04:35,158 - INFO - Layer 30: keep_ratio = 0.4886 (BI = 0.0890)
2025-05-03 03:04:35,158 - INFO - Layer 31: keep_ratio = 0.3540 (BI = 0.4112)
2025-05-03 03:04:35,158 - INFO - Freeing original model from GPU before compression...
2025-05-03 03:04:40,388 - INFO - n_layers=32, n_heads=32, d_model=4096, head_dim=128
2025-05-03 03:04:40,389 - INFO - Applying MoDeGPT compression methods...
2025-05-03 03:05:54,277 - INFO - [MLP] Compressed layer 0 to rank 11008 (Nyström, λ=0.01)
2025-05-03 03:06:04,400 - INFO - [MLP] Compressed layer 1 to rank 4154 (Nyström, λ=0.01)
2025-05-03 03:06:17,434 - INFO - [MLP] Compressed layer 2 to rank 4968 (Nyström, λ=0.01)
2025-05-03 03:06:30,644 - INFO - [MLP] Compressed layer 3 to rank 5046 (Nyström, λ=0.01)
2025-05-03 03:06:42,773 - INFO - [MLP] Compressed layer 4 to rank 5022 (Nyström, λ=0.01)
2025-05-03 03:06:55,360 - INFO - [MLP] Compressed layer 5 to rank 5095 (Nyström, λ=0.01)
2025-05-03 03:07:07,999 - INFO - [MLP] Compressed layer 6 to rank 5107 (Nyström, λ=0.01)
2025-05-03 03:07:20,820 - INFO - [MLP] Compressed layer 7 to rank 5142 (Nyström, λ=0.01)
2025-05-03 03:07:34,344 - INFO - [MLP] Compressed layer 8 to rank 5213 (Nyström, λ=0.01)
2025-05-03 03:07:47,501 - INFO - [MLP] Compressed layer 9 to rank 5264 (Nyström, λ=0.01)
2025-05-03 03:08:01,928 - INFO - [MLP] Compressed layer 10 to rank 5305 (Nyström, λ=0.01)
2025-05-03 03:08:16,255 - INFO - [MLP] Compressed layer 11 to rank 5364 (Nyström, λ=0.01)
2025-05-03 03:08:30,888 - INFO - [MLP] Compressed layer 12 to rank 5359 (Nyström, λ=0.01)
2025-05-03 03:08:45,086 - INFO - [MLP] Compressed layer 13 to rank 5354 (Nyström, λ=0.01)
2025-05-03 03:08:59,721 - INFO - [MLP] Compressed layer 14 to rank 5398 (Nyström, λ=0.01)
2025-05-03 03:09:13,901 - INFO - [MLP] Compressed layer 15 to rank 5345 (Nyström, λ=0.01)
2025-05-03 03:09:28,296 - INFO - [MLP] Compressed layer 16 to rank 5385 (Nyström, λ=0.01)
2025-05-03 03:09:42,807 - INFO - [MLP] Compressed layer 17 to rank 5464 (Nyström, λ=0.01)
2025-05-03 03:09:57,644 - INFO - [MLP] Compressed layer 18 to rank 5502 (Nyström, λ=0.01)
2025-05-03 03:10:12,375 - INFO - [MLP] Compressed layer 19 to rank 5568 (Nyström, λ=0.01)
2025-05-03 03:10:27,765 - INFO - [MLP] Compressed layer 20 to rank 5584 (Nyström, λ=0.01)
2025-05-03 03:10:43,948 - INFO - [MLP] Compressed layer 21 to rank 5646 (Nyström, λ=0.01)
2025-05-03 03:10:59,861 - INFO - [MLP] Compressed layer 22 to rank 5652 (Nyström, λ=0.01)
2025-05-03 03:11:15,954 - INFO - [MLP] Compressed layer 23 to rank 5691 (Nyström, λ=0.01)
2025-05-03 03:11:32,742 - INFO - [MLP] Compressed layer 24 to rank 5695 (Nyström, λ=0.01)
2025-05-03 03:11:48,721 - INFO - [MLP] Compressed layer 25 to rank 5695 (Nyström, λ=0.01)
2025-05-03 03:12:04,902 - INFO - [MLP] Compressed layer 26 to rank 5708 (Nyström, λ=0.01)
2025-05-03 03:12:20,858 - INFO - [MLP] Compressed layer 27 to rank 5714 (Nyström, λ=0.01)
2025-05-03 03:12:37,293 - INFO - [MLP] Compressed layer 28 to rank 5701 (Nyström, λ=0.01)
2025-05-03 03:12:52,910 - INFO - [MLP] Compressed layer 29 to rank 5690 (Nyström, λ=0.01)
2025-05-03 03:13:08,248 - INFO - [MLP] Compressed layer 30 to rank 5378 (Nyström, λ=0.01)
2025-05-03 03:13:16,919 - INFO - [MLP] Compressed layer 31 to rank 3896 (Nyström, λ=0.01)
2025-05-03 03:13:20,664 - INFO - [QK] Compressed layer 0 to rank 128 per head (ridge λ=0.01)
2025-05-03 03:13:24,037 - INFO - [QK] Compressed layer 1 to rank 48 per head (ridge λ=0.01)
2025-05-03 03:13:27,008 - INFO - [QK] Compressed layer 2 to rank 57 per head (ridge λ=0.01)
2025-05-03 03:13:30,081 - INFO - [QK] Compressed layer 3 to rank 58 per head (ridge λ=0.01)
2025-05-03 03:13:32,941 - INFO - [QK] Compressed layer 4 to rank 58 per head (ridge λ=0.01)
2025-05-03 03:13:35,922 - INFO - [QK] Compressed layer 5 to rank 59 per head (ridge λ=0.01)
2025-05-03 03:13:38,825 - INFO - [QK] Compressed layer 6 to rank 59 per head (ridge λ=0.01)
2025-05-03 03:13:42,002 - INFO - [QK] Compressed layer 7 to rank 59 per head (ridge λ=0.01)
2025-05-03 03:13:44,954 - INFO - [QK] Compressed layer 8 to rank 60 per head (ridge λ=0.01)
2025-05-03 03:13:47,961 - INFO - [QK] Compressed layer 9 to rank 61 per head (ridge λ=0.01)
2025-05-03 03:13:51,019 - INFO - [QK] Compressed layer 10 to rank 61 per head (ridge λ=0.01)
2025-05-03 03:13:54,323 - INFO - [QK] Compressed layer 11 to rank 62 per head (ridge λ=0.01)
2025-05-03 03:13:57,409 - INFO - [QK] Compressed layer 12 to rank 62 per head (ridge λ=0.01)
2025-05-03 03:14:00,483 - INFO - [QK] Compressed layer 13 to rank 62 per head (ridge λ=0.01)
2025-05-03 03:14:03,618 - INFO - [QK] Compressed layer 14 to rank 62 per head (ridge λ=0.01)
2025-05-03 03:14:06,695 - INFO - [QK] Compressed layer 15 to rank 62 per head (ridge λ=0.01)
2025-05-03 03:14:09,702 - INFO - [QK] Compressed layer 16 to rank 62 per head (ridge λ=0.01)
2025-05-03 03:14:12,477 - INFO - [QK] Compressed layer 17 to rank 63 per head (ridge λ=0.01)
2025-05-03 03:14:15,333 - INFO - [QK] Compressed layer 18 to rank 63 per head (ridge λ=0.01)
2025-05-03 03:14:18,299 - INFO - [QK] Compressed layer 19 to rank 64 per head (ridge λ=0.01)
2025-05-03 03:14:21,328 - INFO - [QK] Compressed layer 20 to rank 64 per head (ridge λ=0.01)
2025-05-03 03:14:24,224 - INFO - [QK] Compressed layer 21 to rank 65 per head (ridge λ=0.01)
2025-05-03 03:14:27,437 - INFO - [QK] Compressed layer 22 to rank 65 per head (ridge λ=0.01)
2025-05-03 03:14:30,752 - INFO - [QK] Compressed layer 23 to rank 66 per head (ridge λ=0.01)
2025-05-03 03:14:33,900 - INFO - [QK] Compressed layer 24 to rank 66 per head (ridge λ=0.01)
2025-05-03 03:14:37,136 - INFO - [QK] Compressed layer 25 to rank 66 per head (ridge λ=0.01)
2025-05-03 03:14:39,860 - INFO - [QK] Compressed layer 26 to rank 66 per head (ridge λ=0.01)
2025-05-03 03:14:42,640 - INFO - [QK] Compressed layer 27 to rank 66 per head (ridge λ=0.01)
2025-05-03 03:14:45,373 - INFO - [QK] Compressed layer 28 to rank 66 per head (ridge λ=0.01)
2025-05-03 03:14:48,358 - INFO - [QK] Compressed layer 29 to rank 66 per head (ridge λ=0.01)
2025-05-03 03:14:51,042 - INFO - [QK] Compressed layer 30 to rank 62 per head (ridge λ=0.01)
2025-05-03 03:14:53,731 - INFO - [QK] Compressed layer 31 to rank 45 per head (ridge λ=0.01)
2025-05-03 03:15:08,146 - WARNING - [VO] Compression failed at layer 0: The size of tensor a (4096) must match the size of tensor b (128) at non-singleton dimension 1
2025-05-03 03:15:22,869 - WARNING - [VO] Compression failed at layer 1: The size of tensor a (4096) must match the size of tensor b (48) at non-singleton dimension 1
2025-05-03 03:15:37,121 - WARNING - [VO] Compression failed at layer 2: The size of tensor a (4096) must match the size of tensor b (57) at non-singleton dimension 1
2025-05-03 03:15:52,061 - WARNING - [VO] Compression failed at layer 3: The size of tensor a (4096) must match the size of tensor b (58) at non-singleton dimension 1
2025-05-03 03:16:06,993 - WARNING - [VO] Compression failed at layer 4: The size of tensor a (4096) must match the size of tensor b (58) at non-singleton dimension 1
2025-05-03 03:16:21,679 - WARNING - [VO] Compression failed at layer 5: The size of tensor a (4096) must match the size of tensor b (59) at non-singleton dimension 1
2025-05-03 03:16:36,270 - WARNING - [VO] Compression failed at layer 6: The size of tensor a (4096) must match the size of tensor b (59) at non-singleton dimension 1
2025-05-03 03:16:51,146 - WARNING - [VO] Compression failed at layer 7: The size of tensor a (4096) must match the size of tensor b (59) at non-singleton dimension 1
2025-05-03 03:17:05,536 - WARNING - [VO] Compression failed at layer 8: The size of tensor a (4096) must match the size of tensor b (60) at non-singleton dimension 1
2025-05-03 03:17:20,466 - WARNING - [VO] Compression failed at layer 9: The size of tensor a (4096) must match the size of tensor b (61) at non-singleton dimension 1
2025-05-03 03:17:35,096 - WARNING - [VO] Compression failed at layer 10: The size of tensor a (4096) must match the size of tensor b (61) at non-singleton dimension 1
2025-05-03 03:17:49,720 - WARNING - [VO] Compression failed at layer 11: The size of tensor a (4096) must match the size of tensor b (62) at non-singleton dimension 1
2025-05-03 03:18:04,380 - WARNING - [VO] Compression failed at layer 12: The size of tensor a (4096) must match the size of tensor b (62) at non-singleton dimension 1
2025-05-03 03:18:18,766 - WARNING - [VO] Compression failed at layer 13: The size of tensor a (4096) must match the size of tensor b (62) at non-singleton dimension 1
2025-05-03 03:18:33,524 - WARNING - [VO] Compression failed at layer 14: The size of tensor a (4096) must match the size of tensor b (62) at non-singleton dimension 1
2025-05-03 03:18:48,423 - WARNING - [VO] Compression failed at layer 15: The size of tensor a (4096) must match the size of tensor b (62) at non-singleton dimension 1
2025-05-03 03:19:03,371 - WARNING - [VO] Compression failed at layer 16: The size of tensor a (4096) must match the size of tensor b (62) at non-singleton dimension 1
2025-05-03 03:19:17,793 - WARNING - [VO] Compression failed at layer 17: The size of tensor a (4096) must match the size of tensor b (63) at non-singleton dimension 1
2025-05-03 03:19:31,723 - WARNING - [VO] Compression failed at layer 18: The size of tensor a (4096) must match the size of tensor b (63) at non-singleton dimension 1
2025-05-03 03:19:46,386 - WARNING - [VO] Compression failed at layer 19: The size of tensor a (4096) must match the size of tensor b (64) at non-singleton dimension 1
2025-05-03 03:20:00,753 - WARNING - [VO] Compression failed at layer 20: The size of tensor a (4096) must match the size of tensor b (64) at non-singleton dimension 1
2025-05-03 03:20:15,582 - WARNING - [VO] Compression failed at layer 21: The size of tensor a (4096) must match the size of tensor b (65) at non-singleton dimension 1
2025-05-03 03:20:30,254 - WARNING - [VO] Compression failed at layer 22: The size of tensor a (4096) must match the size of tensor b (65) at non-singleton dimension 1
2025-05-03 03:20:45,168 - WARNING - [VO] Compression failed at layer 23: The size of tensor a (4096) must match the size of tensor b (66) at non-singleton dimension 1
2025-05-03 03:20:59,449 - WARNING - [VO] Compression failed at layer 24: The size of tensor a (4096) must match the size of tensor b (66) at non-singleton dimension 1
