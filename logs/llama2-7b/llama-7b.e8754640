2025-05-04 01:14:18,625 - INFO - Loading model: meta-llama/Llama-2-7b-hf
2025-05-04 01:14:18,625 - INFO - Loading model from: meta-llama/Llama-2-7b-hf
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00, 11.89it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00, 11.87it/s]
2025-05-04 01:14:25,672 - INFO - ✔ Loaded model on cuda:0 with float16.
2025-05-04 01:14:25,673 - INFO - No pad_token found. Set pad_token = eos_token.
2025-05-04 01:14:25,674 - INFO - Loading calibration and evaluation texts...
2025-05-04 01:14:39,931 - INFO - Evaluating original model (for baseline perplexity)...
2025-05-04 01:15:15,821 - INFO - Original model perplexity on WikiText2: 5.72
2025-05-04 01:15:15,823 - INFO - Calibrating model...
2025-05-04 01:15:15,823 - INFO - Detected architecture: llama
2025-05-04 01:23:00,994 - INFO - Finished calibration and computed BI scores.
2025-05-04 01:23:01,000 - INFO - Allocating layer sparsity...
2025-05-04 01:23:01,000 - INFO - Allocating global sparsity using target keep ratio 0.5000 and temperature 1.0
2025-05-04 01:23:01,000 - INFO - Layer  0: keep_ratio = 1.0000 (BI = 0.4532)
2025-05-04 01:23:01,000 - INFO - Layer  1: keep_ratio = 0.3774 (BI = 0.3471)
2025-05-04 01:23:01,000 - INFO - Layer  2: keep_ratio = 0.4513 (BI = 0.1683)
2025-05-04 01:23:01,001 - INFO - Layer  3: keep_ratio = 0.4585 (BI = 0.1526)
2025-05-04 01:23:01,001 - INFO - Layer  4: keep_ratio = 0.4563 (BI = 0.1575)
2025-05-04 01:23:01,001 - INFO - Layer  5: keep_ratio = 0.4629 (BI = 0.1431)
2025-05-04 01:23:01,001 - INFO - Layer  6: keep_ratio = 0.4640 (BI = 0.1407)
2025-05-04 01:23:01,001 - INFO - Layer  7: keep_ratio = 0.4671 (BI = 0.1339)
2025-05-04 01:23:01,001 - INFO - Layer  8: keep_ratio = 0.4736 (BI = 0.1201)
2025-05-04 01:23:01,001 - INFO - Layer  9: keep_ratio = 0.4782 (BI = 0.1105)
2025-05-04 01:23:01,001 - INFO - Layer 10: keep_ratio = 0.4819 (BI = 0.1027)
2025-05-04 01:23:01,001 - INFO - Layer 11: keep_ratio = 0.4873 (BI = 0.0916)
2025-05-04 01:23:01,001 - INFO - Layer 12: keep_ratio = 0.4869 (BI = 0.0925)
2025-05-04 01:23:01,001 - INFO - Layer 13: keep_ratio = 0.4864 (BI = 0.0936)
2025-05-04 01:23:01,001 - INFO - Layer 14: keep_ratio = 0.4904 (BI = 0.0853)
2025-05-04 01:23:01,001 - INFO - Layer 15: keep_ratio = 0.4856 (BI = 0.0952)
2025-05-04 01:23:01,001 - INFO - Layer 16: keep_ratio = 0.4893 (BI = 0.0876)
2025-05-04 01:23:01,001 - INFO - Layer 17: keep_ratio = 0.4964 (BI = 0.0731)
2025-05-04 01:23:01,001 - INFO - Layer 18: keep_ratio = 0.4998 (BI = 0.0663)
2025-05-04 01:23:01,001 - INFO - Layer 19: keep_ratio = 0.5058 (BI = 0.0543)
2025-05-04 01:23:01,001 - INFO - Layer 20: keep_ratio = 0.5073 (BI = 0.0514)
2025-05-04 01:23:01,001 - INFO - Layer 21: keep_ratio = 0.5130 (BI = 0.0403)
2025-05-04 01:23:01,001 - INFO - Layer 22: keep_ratio = 0.5135 (BI = 0.0393)
2025-05-04 01:23:01,001 - INFO - Layer 23: keep_ratio = 0.5170 (BI = 0.0324)
2025-05-04 01:23:01,001 - INFO - Layer 24: keep_ratio = 0.5174 (BI = 0.0317)
2025-05-04 01:23:01,001 - INFO - Layer 25: keep_ratio = 0.5174 (BI = 0.0317)
2025-05-04 01:23:01,001 - INFO - Layer 26: keep_ratio = 0.5186 (BI = 0.0295)
2025-05-04 01:23:01,001 - INFO - Layer 27: keep_ratio = 0.5191 (BI = 0.0284)
2025-05-04 01:23:01,001 - INFO - Layer 28: keep_ratio = 0.5180 (BI = 0.0306)
2025-05-04 01:23:01,001 - INFO - Layer 29: keep_ratio = 0.5170 (BI = 0.0326)
2025-05-04 01:23:01,001 - INFO - Layer 30: keep_ratio = 0.4886 (BI = 0.0890)
2025-05-04 01:23:01,001 - INFO - Layer 31: keep_ratio = 0.3540 (BI = 0.4112)
2025-05-04 01:23:01,001 - INFO - Freeing original model from GPU before compression...
2025-05-04 01:23:08,677 - INFO - n_layers=32, n_heads=32, d_model=4096, head_dim=128
2025-05-04 01:23:08,678 - INFO - Applying MoDeGPT compression methods...
2025-05-04 01:23:54,843 - INFO - [MLP] Compressed layer 0 to rank 11008 (Nyström, λ=0.01)
2025-05-04 01:23:59,291 - INFO - [MLP] Compressed layer 1 to rank 4154 (Nyström, λ=0.01)
2025-05-04 01:24:05,613 - INFO - [MLP] Compressed layer 2 to rank 4968 (Nyström, λ=0.01)
2025-05-04 01:24:11,990 - INFO - [MLP] Compressed layer 3 to rank 5046 (Nyström, λ=0.01)
2025-05-04 01:24:18,077 - INFO - [MLP] Compressed layer 4 to rank 5022 (Nyström, λ=0.01)
2025-05-04 01:24:24,519 - INFO - [MLP] Compressed layer 5 to rank 5095 (Nyström, λ=0.01)
2025-05-04 01:24:31,026 - INFO - [MLP] Compressed layer 6 to rank 5107 (Nyström, λ=0.01)
2025-05-04 01:24:37,448 - INFO - [MLP] Compressed layer 7 to rank 5142 (Nyström, λ=0.01)
2025-05-04 01:24:44,247 - INFO - [MLP] Compressed layer 8 to rank 5213 (Nyström, λ=0.01)
2025-05-04 01:24:50,683 - INFO - [MLP] Compressed layer 9 to rank 5264 (Nyström, λ=0.01)
2025-05-04 01:24:57,867 - INFO - [MLP] Compressed layer 10 to rank 5305 (Nyström, λ=0.01)
2025-05-04 01:25:04,857 - INFO - [MLP] Compressed layer 11 to rank 5364 (Nyström, λ=0.01)
2025-05-04 01:25:12,202 - INFO - [MLP] Compressed layer 12 to rank 5359 (Nyström, λ=0.01)
2025-05-04 01:25:19,291 - INFO - [MLP] Compressed layer 13 to rank 5354 (Nyström, λ=0.01)
2025-05-04 01:25:26,601 - INFO - [MLP] Compressed layer 14 to rank 5398 (Nyström, λ=0.01)
2025-05-04 01:25:33,801 - INFO - [MLP] Compressed layer 15 to rank 5345 (Nyström, λ=0.01)
2025-05-04 01:25:41,058 - INFO - [MLP] Compressed layer 16 to rank 5385 (Nyström, λ=0.01)
2025-05-04 01:25:48,257 - INFO - [MLP] Compressed layer 17 to rank 5464 (Nyström, λ=0.01)
2025-05-04 01:25:55,957 - INFO - [MLP] Compressed layer 18 to rank 5502 (Nyström, λ=0.01)
2025-05-04 01:26:03,582 - INFO - [MLP] Compressed layer 19 to rank 5568 (Nyström, λ=0.01)
2025-05-04 01:26:11,471 - INFO - [MLP] Compressed layer 20 to rank 5584 (Nyström, λ=0.01)
2025-05-04 01:26:19,958 - INFO - [MLP] Compressed layer 21 to rank 5646 (Nyström, λ=0.01)
2025-05-04 01:26:28,177 - INFO - [MLP] Compressed layer 22 to rank 5652 (Nyström, λ=0.01)
2025-05-04 01:26:36,587 - INFO - [MLP] Compressed layer 23 to rank 5691 (Nyström, λ=0.01)
2025-05-04 01:26:45,279 - INFO - [MLP] Compressed layer 24 to rank 5695 (Nyström, λ=0.01)
2025-05-04 01:26:51,582 - INFO - [MLP] Compressed layer 25 to rank 5695 (Nyström, λ=0.01)
2025-05-04 01:26:58,262 - INFO - [MLP] Compressed layer 26 to rank 5708 (Nyström, λ=0.01)
2025-05-04 01:27:07,353 - INFO - [MLP] Compressed layer 27 to rank 5714 (Nyström, λ=0.01)
2025-05-04 01:27:16,724 - INFO - [MLP] Compressed layer 28 to rank 5701 (Nyström, λ=0.01)
2025-05-04 01:27:25,607 - INFO - [MLP] Compressed layer 29 to rank 5690 (Nyström, λ=0.01)
2025-05-04 01:27:34,110 - INFO - [MLP] Compressed layer 30 to rank 5378 (Nyström, λ=0.01)
2025-05-04 01:27:38,396 - INFO - [MLP] Compressed layer 31 to rank 3896 (Nyström, λ=0.01)
2025-05-04 01:27:40,180 - INFO - [QK] Compressed layer 0 to rank 128 per head (ridge λ=0.01)
2025-05-04 01:27:41,668 - INFO - [QK] Compressed layer 1 to rank 48 per head (ridge λ=0.01)
2025-05-04 01:27:43,127 - INFO - [QK] Compressed layer 2 to rank 57 per head (ridge λ=0.01)
2025-05-04 01:27:44,521 - INFO - [QK] Compressed layer 3 to rank 58 per head (ridge λ=0.01)
2025-05-04 01:27:45,987 - INFO - [QK] Compressed layer 4 to rank 58 per head (ridge λ=0.01)
2025-05-04 01:27:47,437 - INFO - [QK] Compressed layer 5 to rank 59 per head (ridge λ=0.01)
2025-05-04 01:27:48,857 - INFO - [QK] Compressed layer 6 to rank 59 per head (ridge λ=0.01)
2025-05-04 01:27:50,442 - INFO - [QK] Compressed layer 7 to rank 59 per head (ridge λ=0.01)
2025-05-04 01:27:51,825 - INFO - [QK] Compressed layer 8 to rank 60 per head (ridge λ=0.01)
2025-05-04 01:27:53,285 - INFO - [QK] Compressed layer 9 to rank 61 per head (ridge λ=0.01)
2025-05-04 01:27:54,767 - INFO - [QK] Compressed layer 10 to rank 61 per head (ridge λ=0.01)
2025-05-04 01:27:56,221 - INFO - [QK] Compressed layer 11 to rank 62 per head (ridge λ=0.01)
2025-05-04 01:27:57,728 - INFO - [QK] Compressed layer 12 to rank 62 per head (ridge λ=0.01)
2025-05-04 01:27:59,120 - INFO - [QK] Compressed layer 13 to rank 62 per head (ridge λ=0.01)
2025-05-04 01:28:00,477 - INFO - [QK] Compressed layer 14 to rank 62 per head (ridge λ=0.01)
2025-05-04 01:28:01,941 - INFO - [QK] Compressed layer 15 to rank 62 per head (ridge λ=0.01)
2025-05-04 01:28:03,313 - INFO - [QK] Compressed layer 16 to rank 62 per head (ridge λ=0.01)
2025-05-04 01:28:04,664 - INFO - [QK] Compressed layer 17 to rank 63 per head (ridge λ=0.01)
2025-05-04 01:28:06,048 - INFO - [QK] Compressed layer 18 to rank 63 per head (ridge λ=0.01)
2025-05-04 01:28:07,281 - INFO - [QK] Compressed layer 19 to rank 64 per head (ridge λ=0.01)
2025-05-04 01:28:08,570 - INFO - [QK] Compressed layer 20 to rank 64 per head (ridge λ=0.01)
2025-05-04 01:28:10,018 - INFO - [QK] Compressed layer 21 to rank 65 per head (ridge λ=0.01)
2025-05-04 01:28:11,551 - INFO - [QK] Compressed layer 22 to rank 65 per head (ridge λ=0.01)
2025-05-04 01:28:13,036 - INFO - [QK] Compressed layer 23 to rank 66 per head (ridge λ=0.01)
2025-05-04 01:28:14,544 - INFO - [QK] Compressed layer 24 to rank 66 per head (ridge λ=0.01)
2025-05-04 01:28:16,073 - INFO - [QK] Compressed layer 25 to rank 66 per head (ridge λ=0.01)
2025-05-04 01:28:17,549 - INFO - [QK] Compressed layer 26 to rank 66 per head (ridge λ=0.01)
2025-05-04 01:28:18,933 - INFO - [QK] Compressed layer 27 to rank 66 per head (ridge λ=0.01)
2025-05-04 01:28:20,293 - INFO - [QK] Compressed layer 28 to rank 66 per head (ridge λ=0.01)
2025-05-04 01:28:21,616 - INFO - [QK] Compressed layer 29 to rank 66 per head (ridge λ=0.01)
2025-05-04 01:28:22,795 - INFO - [QK] Compressed layer 30 to rank 62 per head (ridge λ=0.01)
2025-05-04 01:28:24,010 - INFO - [QK] Compressed layer 31 to rank 45 per head (ridge λ=0.01)
2025-05-04 01:28:27,285 - INFO - [VO] Compressed layer 0 to rank 4096 (Type-III SVD, llama)
2025-05-04 01:28:30,530 - INFO - [VO] Compressed layer 1 to rank 1546 (Type-III SVD, llama)
2025-05-04 01:28:33,570 - INFO - [VO] Compressed layer 2 to rank 1848 (Type-III SVD, llama)
2025-05-04 01:28:36,510 - INFO - [VO] Compressed layer 3 to rank 1877 (Type-III SVD, llama)
2025-05-04 01:28:39,637 - INFO - [VO] Compressed layer 4 to rank 1868 (Type-III SVD, llama)
2025-05-04 01:28:42,640 - INFO - [VO] Compressed layer 5 to rank 1895 (Type-III SVD, llama)
2025-05-04 01:28:45,679 - INFO - [VO] Compressed layer 6 to rank 1900 (Type-III SVD, llama)
2025-05-04 01:28:48,768 - INFO - [VO] Compressed layer 7 to rank 1913 (Type-III SVD, llama)
2025-05-04 01:28:51,895 - INFO - [VO] Compressed layer 8 to rank 1939 (Type-III SVD, llama)
2025-05-04 01:28:54,963 - INFO - [VO] Compressed layer 9 to rank 1958 (Type-III SVD, llama)
2025-05-04 01:28:58,103 - INFO - [VO] Compressed layer 10 to rank 1974 (Type-III SVD, llama)
2025-05-04 01:29:01,297 - INFO - [VO] Compressed layer 11 to rank 1996 (Type-III SVD, llama)
2025-05-04 01:29:04,453 - INFO - [VO] Compressed layer 12 to rank 1994 (Type-III SVD, llama)
2025-05-04 01:29:07,720 - INFO - [VO] Compressed layer 13 to rank 1992 (Type-III SVD, llama)
2025-05-04 01:29:10,898 - INFO - [VO] Compressed layer 14 to rank 2008 (Type-III SVD, llama)
2025-05-04 01:29:14,111 - INFO - [VO] Compressed layer 15 to rank 1988 (Type-III SVD, llama)
2025-05-04 01:29:17,113 - INFO - [VO] Compressed layer 16 to rank 2004 (Type-III SVD, llama)
2025-05-04 01:29:19,995 - INFO - [VO] Compressed layer 17 to rank 2033 (Type-III SVD, llama)
2025-05-04 01:29:23,031 - INFO - [VO] Compressed layer 18 to rank 2047 (Type-III SVD, llama)
2025-05-04 01:29:26,058 - INFO - [VO] Compressed layer 19 to rank 2071 (Type-III SVD, llama)
2025-05-04 01:29:29,066 - INFO - [VO] Compressed layer 20 to rank 2077 (Type-III SVD, llama)
2025-05-04 01:29:32,131 - INFO - [VO] Compressed layer 21 to rank 2101 (Type-III SVD, llama)
2025-05-04 01:29:35,073 - INFO - [VO] Compressed layer 22 to rank 2103 (Type-III SVD, llama)
2025-05-04 01:29:38,053 - INFO - [VO] Compressed layer 23 to rank 2117 (Type-III SVD, llama)
2025-05-04 01:29:40,918 - INFO - [VO] Compressed layer 24 to rank 2119 (Type-III SVD, llama)
2025-05-04 01:29:43,911 - INFO - [VO] Compressed layer 25 to rank 2119 (Type-III SVD, llama)
2025-05-04 01:29:46,908 - INFO - [VO] Compressed layer 26 to rank 2124 (Type-III SVD, llama)
2025-05-04 01:29:49,815 - INFO - [VO] Compressed layer 27 to rank 2126 (Type-III SVD, llama)
2025-05-04 01:29:52,753 - INFO - [VO] Compressed layer 28 to rank 2121 (Type-III SVD, llama)
2025-05-04 01:29:55,652 - INFO - [VO] Compressed layer 29 to rank 2117 (Type-III SVD, llama)
2025-05-04 01:29:58,744 - INFO - [VO] Compressed layer 30 to rank 2001 (Type-III SVD, llama)
2025-05-04 01:30:01,716 - INFO - [VO] Compressed layer 31 to rank 1449 (Type-III SVD, llama)
2025-05-04 01:30:01,720 - INFO - Saving compressed model...
2025-05-04 01:32:16,744 - INFO - ✔ Model, tokenizer, and tokenizer_source.txt saved to /u/scratch/x/xxiong/compressed_output/llama2-7b
2025-05-04 01:32:16,747 - INFO - Reloading compressed model for evaluation...
2025-05-04 01:32:16,747 - INFO - Reloading compressed model from: /u/scratch/x/xxiong/compressed_output/llama2-7b
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:03,  1.88s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:03<00:01,  1.87s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.08s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.29s/it]
2025-05-04 01:33:44,168 - INFO - ✔ Reloaded compressed model to cuda:0 successfully.
2025-05-04 01:34:17,912 - INFO - Compressed model perplexity on WikiText2: 10326.17
